---
import { getEntry, render } from "astro:content";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import Markdown from "@components/misc/Markdown.astro";
import { Icon } from "astro-icon/components";
import { siteConfig } from "@/config";

// giscus评论区文章页集成
import Giscus from "../components/misc/Giscus.astro";

import type { FrlinksData } from "@/types/data";
import frlinksjson from "@/data/frlinks.json";

const frlinksMd = await getEntry("spec", "frlinks");
if (!frlinksMd) throw new Error("友链说明文件未找到");

const { Content } = await render(frlinksMd);
const { frlinks } = frlinksjson as FrlinksData;
---
<MainGridLayout title="友链" description="友情链接 - 与优秀的创作者们相连，共享知识与成长">
  <div class="w-full rounded-[var(--radius-large)] overflow-hidden relative">
    <div class="card-base p-6 md:p-8">
        <div class="flex items-center gap-2 mb-6">
            <div class="h-8 w-8 rounded-lg bg-[var(--primary)] flex items-center justify-center text-white dark:text-black/70">
                <Icon name="material-symbols:diversity-3" class="text-[1.5rem]">
            </div>
            <h1 class="text-2xl font-bold text-black dark:text-white">友链</h1>
        </div>
        <link rel="stylesheet" href="/src/styles/frlink-card.css" />
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {frlinks.map((frlink) => (
                <a href={frlink.url} target="_blank" class="frlink-card">
                    <div class="flex items-center gap-2">
                        <div class="relative w-5 h-5 rounded overflow-hidden" style={`--theme-hue: ${siteConfig.themeColor.hue}`}>
                            <div class="loading-bar absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-1 bg-gray-200 dark:bg-gray-700 z-10 rounded-full overflow-hidden">
                                <div class="loading-progress h-full w-8 bg-[oklch(0.70_0.14_var(--theme-hue))] animate-loading-progress rounded-full"></div>
                            </div>
                            <img src={frlink.avatar} loading="lazy" class="w-full h-full object-cover opacity-0 transition-opacity duration-500" alt={`${frlink.name}的头像`} onload="this.style.opacity='1'; this.parentElement.querySelector('.loading-bar').style.opacity='0';"/>
                        </div>
                        <div class="font-bold text-black dark:text-white">{frlink.name}</div>
                    </div>
                    <div class="text-sm text-black/50 dark:text-white/50">{frlink.description}</div>
                </a>
            ))}
        </div>
        <br>
        <Markdown class="mb-10">
            <Content />
        </Markdown>

        <!-- giscus评论区文章页集成 -->
        <Giscus
            repo="RolinShmily/SrP-BloG"
            repoId="R_kgDOQI8WBA"
            category="Announcements"
            categoryId="DIC_kwDOQI8WBM4Cxde8"
            lang="zh-CN"
        />

    </div>
  </div>
</MainGridLayout>

<style>
    .friend-card {
        @apply flex flex-col gap-1 p-4 rounded-lg bg-[var(--card-bg)] border border-black/10 dark:border-white/10 hover:border-black/20 dark:hover:border-white/20 hover:bg-black/5 dark:hover:bg-white/5;
        transition-property: all;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 0.15s;
    }

    .friend-card:active {
        scale: .98;
        background-color: var(--btn-regular-bg-active);
    }

    .friend-card:hover {
        background-color: var(--btn-regular-bg-hover);
    }

    .friend-card:hover .font-bold {
        color: var(--btn-content);
    }

    .friend-card:hover .text-sm {
    @apply text-gray-700 dark:text-white;
    }

    .friend-card .font-bold,
    .friend-card .text-sm {
        transition-property: color;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 0.15s;
    }

    .loading-bar {
        transition: opacity 0.5s ease-out;
    }

    @keyframes loading-progress {
        0% {
            transform: translateX(-100%);
        }
        100% {
            transform: translateX(400%);
        }
    }

    .animate-loading-progress {
        animation: loading-progress 1.5s ease-in-out infinite;
    }
</style>
